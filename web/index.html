<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sea Dogs Tavern | 디스코드 봇 관리</title>
    <!-- 기본 스타일시트 -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/loading.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <!-- 모듈별 스타일시트는 동적으로 로드됨 -->
    <!-- 수정 사항용 스타일시트: 문제 해결을 위한 CSS 추가 -->
    <link rel="stylesheet" href="css/fixes.css">
    <!-- 개선된 UI 스타일시트 추가 -->
    <link rel="stylesheet" href="css/improved.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- 구글 폰트 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 로딩 화면 -->
    <div id="loading-container">
        <div class="loading-content">
            <div class="loading-logo">
                <!-- 로컬 GIF 파일로 변경 -->
                <img src="Animation1.gif" alt="aimbot.ad">
            </div>
            <div class="loading-text">
                <span id="loading-message">안녕하세요</span>
            </div>
            <div class="loading-progress-container">
                <div class="loading-progress-bar" id="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- 메인 컨테이너 -->
    <div id="main-container" style="display: none;">
        <!-- 사이드바 메뉴 (개선된 구조) -->
        <div class="side-bar">
            <div class="side-bar__icon-box">
                <div class="side-bar__icon-1">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
            
            <!-- 사용자 정보 섹션 추가 -->
            <div class="sidebar-user-info">
                <div class="sidebar-user-header">
                    <div class="sidebar-user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="sidebar-user-name" id="sidebar-username">사용자</div>
                </div>
                <div class="sidebar-user-details">
                    <div class="sidebar-user-detail-item">
                        <span class="sidebar-user-detail-label">권한:</span>
                        <span class="sidebar-user-detail-value" id="sidebar-role">-</span>
                    </div>
                    <div class="sidebar-user-detail-item">
                        <span class="sidebar-user-detail-label">담당:</span>
                        <span class="sidebar-user-detail-value" id="sidebar-server">-</span>
                    </div>
                </div>
                <div class="sidebar-user-actions">
                    <button id="sidebar-logout-btn" class="btn-logout">로그아웃</button>
                </div>
            </div>
            
            <!-- 온라인 관리자 섹션 추가 -->
            <div class="sidebar-online-admins">
                <h3>온라인 관리자</h3>
                <div id="sidebar-admins-list">
                    <!-- 여기에 온라인 관리자 목록이 동적으로 표시됨 -->
                </div>
            </div>
            
            <ul>
                <li>
                    <a href="#main"><i class="fas fa-home"></i> 메인</a>
                </li>
                <li>
                    <a href="#dashboard"><i class="fas fa-chart-line"></i> 대시보드</a>
                </li>
                <li>
                    <a href="#module-mgmt"><i class="fas fa-puzzle-piece"></i> 모듈관리</a>
                </li>
                <li>
                    <a href="#embed"><i class="fas fa-image"></i> 임베드</a>
                </li>
                <li>
                    <a href="#admin"><i class="fas fa-lock"></i> 관리자</a>
                </li>
                <li class="login-menu-item">
                    <a href="#" id="login-btn"><i class="fas fa-sign-in-alt"></i> 로그인</a>
                </li>
            </ul>
        </div>

        <!-- 콘텐츠 영역 -->
        <div id="content-container">
            <!-- 메인 페이지 (처음 표시) -->
            <div id="main-page" class="content-page active-page">
                <div class="main-header animate-item">
                    <!-- 로컬 GIF 파일로 변경 -->
                    <img src="Animation1.gif" alt="aimbot.ad" class="main-logo">
                </div>
                <div class="main-body animate-item">
                    <h1>Aimbot 대시보드</h1>
                </div>
                <div class="main-footer animate-item">
                    <p>AOW Union • TBO SDT clan</p>
                    <div class="discord-links">
                        <a href="#" class="discord-link"><i class="fab fa-discord"></i> SDT 디스코드 서버</a>
                        <a href="#" class="discord-link"><i class="fab fa-discord"></i> TBO 디스코드 서버</a>
                    </div>
                    <p>디스코드 봇 제작 및 호스팅 문의</p>
                    <div class="tech-tags">
                        <span class="tag"><i class="fab fa-python"></i> Python</span>
                        <span class="tag"><i class="fab fa-js"></i> Discord.js</span>
                        <span class="tag"><i class="fas fa-code"></i> API 연동</span>
                        <span class="tag"><i class="fas fa-server"></i> 웹/클라우드 호스팅</span>
                        <span class="tag"><i class="fas fa-users"></i> 클랜</span>
                    </div>
                </div>
            </div>

            <!-- 모듈 컨텐츠는 여기에 동적으로 로드됨 -->
            <div id="module-content"></div>
        </div>
    </div>

    <!-- 로그인 모달 -->
    <div id="login-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>로그인</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">아이디</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn-primary">로그인</button>
                <p class="register-link">
                    <a href="#" id="register-btn">회원가입</a>
                </p>
            </form>
            <p class="login-message"></p>
        </div>
    </div>
    
    <!-- 회원가입 모달 -->
    <div id="register-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>회원가입</h2>
            <form id="register-form">
                <div class="form-group">
                    <label for="register-username">아이디</label>
                    <input type="text" id="register-username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="register-password">비밀번호</label>
                    <input type="password" id="register-password" name="password" required>
                </div>
                <div class="form-group">
                    <label for="register-password-confirm">비밀번호 확인</label>
                    <input type="password" id="register-password-confirm" name="password-confirm" required>
                </div>
                <div class="form-group">
                    <label for="register-invite-code">초대 코드</label>
                    <input type="text" id="register-invite-code" name="invite-code" required>
                </div>
                <button type="submit" class="btn-primary">회원가입</button>
            </form>
            <p class="register-message"></p>
        </div>
    </div>

    <!-- 기본 스크립트 -->
    <script src="js/main.js"></script>
    <!-- 개선된 웹소켓 & 인증 스크립트 -->
    <script src="js/router.js"></script>
    <script src="js/websocket.js"></script>
    <script src="js/auth.js"></script>
    <!-- 대시보드 개선 스크립트 -->
    <script src="js/dashboard.js"></script>
    <!-- 모듈별 스크립트는 동적으로 로드됨 -->
    
    <!-- 사이드바 온라인 관리자 관리 스크립트 -->
    <script>
        // 사이드바 온라인 관리자 목록 업데이트 함수
        function updateSidebarOnlineAdmins(admins) {
            const adminsContainer = document.getElementById('sidebar-admins-list');
            if (!adminsContainer) return;
            
            // 컨테이너 비우기
            adminsContainer.innerHTML = '';
            
            // 관리자가 없을 경우
            if (!admins || admins.length === 0) {
                adminsContainer.innerHTML = '<div class="no-admins">온라인 관리자가 없습니다.</div>';
                return;
            }
            
            // 관리자 목록 생성
            admins.forEach(admin => {
                const adminItem = document.createElement('div');
                adminItem.className = 'sidebar-admin-item';
                
                let roleClass = 'user';
                if (admin.role === 'admin' || admin.role === 'level1') {
                    roleClass = 'admin';
                } else if (admin.role === 'level2') {
                    roleClass = 'mod';
                } else if (admin.role === 'level3') {
                    roleClass = 'helper';
                }
                
                adminItem.innerHTML = `
                    <div class="sidebar-admin-role ${roleClass}"></div>
                    <div class="sidebar-admin-name">${admin.username}</div>
                `;
                
                adminsContainer.appendChild(adminItem);
            });
        }
        
        // 웹소켓 메시지 핸들러 추가
        document.addEventListener('websocket_ready', function() {
            // 온라인 관리자 목록
            WebSocketManager.messageHandlers['onlineAdmins'] = (message) => {
                if (message.admins) {
                    updateSidebarOnlineAdmins(message.admins);
                    // 기존 함수도 호출
                    if (typeof updateOnlineAdmins === 'function') {
                        updateOnlineAdmins(message.admins);
                    }
                }
            };
        });
        
        // 사이드바 로그아웃 버튼 리스너
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const sidebarLogoutBtn = document.getElementById('sidebar-logout-btn');
                if (sidebarLogoutBtn) {
                    sidebarLogoutBtn.addEventListener('click', function() {
                        if (typeof AuthManager !== 'undefined' && AuthManager.logout) {
                            AuthManager.logout();
                        }
                    });
                }
            }, 6500);
        });
    </script>
</body>
</html>